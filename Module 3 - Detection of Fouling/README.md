# ðŸ“¦ Module 3 â€“ Detection of Fouling

This module focuses on detecting and analyzing **biofouling on underwater panels** using a combination of gradient-based thresholding and statistical evaluation techniques.



---

##  Script Descriptions

### `check_generated_data_everything.py` â€” _Sort IoU Results from Threshold Sweep_

Reads the IoU results CSV file generated by the threshold testing script and **sorts images by a selected IoU score** (default: `IoU_5`).

**Features:**
- Loads a CSV file generated by `AI_temp_finding_thresholds.py`
- Extracts and parses IoU values from a specified threshold column (e.g., `IoU_5`)
- Sorts all image entries **by descending IoU value**
- Prints a clean, aligned list of:
  - Filenames
  - Corresponding IoU scores

---

### `HistogramForThePanelUsed.py` â€” _Histogram of Fouling vs. Panel (RGB & HSV)_

Analyzes color distributions to differentiate between **fouling** and **non-fouling (panel)** regions based on **LabelMe annotations**. This script generates two types of histograms:
- **Red channel histogram** (from RGB)
- **Hue channel histogram** (from HSV)

**Functionality Includes:**
- Parses polygon-based annotations (`fouling`, `none`, and `panel`) from JSON files
- Creates binary masks for fouling and not-fouling areas
- Extracts:
  - **Red channel values** (RGB)
  - **Hue values** (HSV)
- Plots normalized histograms to visualize pixel intensity distributions

**How It Works:**
1. **Red Channel Histogram**
   - Computes from the red channel of BGR images using `.png`/`.jpg`
   - Fouling and non-fouling areas are extracted based on masks
   - Histogram plotted with:
     - **Solid red line** = Fouling
     - **Dotted red line** = Panel

2. **Hue Histogram (HSV)**
   - Converts images to HSV space
   - Extracts hue values in annotated masks
   - Histogram plotted from hue (0â€“179)

---

### `IouForFoulingRedUsed.py` â€” _Evaluate Fouling Prediction with HSV-based Red Filtering_

Compares predicted fouling areas (derived using HSV red color filtering) against manually annotated fouling masks by computing **IoU (Intersection over Union)**.

**Features:**
- Loads `LabelMe`-formatted annotations (`.json`) and corresponding images.
- Extracts:
  - **Panel masks**
  - **Annotated fouling masks**
  - **Regions to ignore** (labelled `"none"`)
- Converts each image to HSV and uses hue thresholds (`0â€“15`, `170â€“179`) to detect **red areas**.
- Predicts fouling as **panel area minus red regions**.
- Computes **IoU score** between predicted and annotated fouling masks.
- Supports batch processing of all imageâ€“JSON pairs in a folder.

**Optional:**
- Includes a `visualize_all()` function (commented out) to show original image, masks, and overlayed IoU visually.


---

### `MeanAverageSTDIoUUsed.py` â€” _Compute IoU Statistics (Mean, Median, Std)_

Calculates basic statistical metrics (mean, median, standard deviation) for multiple sets of manually entered IoU values.

**Features:**
- Supports multiple sets of IoU values (e.g., `iou_values_m4`, `m5`, `m6`, etc.)
- For each list of values:
  - Converts to NumPy array
  - Computes:
    - **Mean IoU**
    - **Median IoU**
    - **Standard deviation**
- Prints results in terminal


---

### `AI_temp_finding_thresholds.py` â€” _Threshold Sweeping for Fouling Detection_

Systematically tests **gradient similarity thresholds** to identify fouling within labeled panel regions, using LabelMe annotations.

**Features:**
- Calculates **gradient magnitude** of grayscale images using Sobel filters
- Applies a **custom similarity filter** to count how similar each panel pixel is to its neighbors  
  - Uses NumPy's `as_strided` for efficient local patch comparison
- Uses LabelMe JSONs to extract regions labeled as `panel`, `fouling`, and `none`
- Sweeps across multiple similarity thresholds (`1â€“25`) to:
  - Generate fouling masks based on local similarity
  - Compute **IoU (Intersection over Union)** scores between predicted fouling and ground truth
- Outputs a `.csv` summary for each image containing:
  - IoU scores across all thresholds
  - The **best-performing threshold** and its IoU value


---

### `Test_Gradient_Thresh.py` â€” _Fouling Detection Using Gradient Similarity_

Performs panel-level fouling detection by analyzing local gradient similarity within a grayscale image, and compares the prediction with annotated ground truth masks using the IoU metric.

**Features:**
- Loads a grayscale panel image and corresponding JSON annotations (polygonal masks for `panel`, `fouling`, and `none`)
- Computes a **gradient magnitude map** using the Sobel operator
- Applies a **local similarity filter** using `as_strided` to count similar neighbors in a window
- Determines fouling based on similarity thresholds
- Constructs a binary mask of predicted fouling areas
- Computes **IoU** between predicted and ground-truth fouling masks
- Generates visual outputs:
  - **Normalized similarity heatmap** on the panel area
  - **Predicted vs Ground Truth masks**
  - **Original RGB image** for reference

**Use Case:**
- Evaluates how well similarity-based analysis can predict fouling regions on panel surfaces.
- Supports threshold tuning and visualization for research or manual inspection.

---

### `Visualise_Gradient_Thresh.py` â€” _Gradient-Based Fouling Detection with Visualization_

Analyzes a single panel image for **fouling detection** using a **local gradient similarity filter**, visualizes results as a **heatmap**, and evaluates performance via **IoU** with human-annotated ground truth from LabelMe.

**Features:**
- Computes **Sobel gradient magnitude** on grayscale images  
  - Normalizes gradient magnitude across the image
- Applies a **custom similarity filter** to each pixel using a 5Ã—5 window  
  - Counts how many neighboring pixels have similar gradient values (within Â±5)  
  - Efficiently implemented using NumPy's `as_strided`
- Loads region masks from LabelMe `.json`:
  - `panel` â€” area to evaluate
  - `fouling` â€” ground truth fouling
  - `none` â€” exclusion zones
- Classifies each **panel pixel** as fouling or not:
  - Pixel is labeled **fouling** if it has **< 20 similar neighbors**
- Computes and prints **IoU score** between predicted and ground truth fouling masks
- Generates a **2-panel visualization**:
  - Left: Original RGB image
  - Right: Gradient similarity heatmap (custom colormap from blue â†’ green â†’ red)
---


## Authors

- Frederik Nielsen  
- Andreas Hasselholt JÃ¸rgensensen
- Christian NÃ¸rkÃ¦r Petersen
- Oliver SÃ¸ndermÃ¸lle Hansen
- Sture Nicolai Jaque
